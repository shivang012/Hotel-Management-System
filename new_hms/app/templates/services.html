{% extends 'base.html' %}
{% block content %}
<div class="page-header">
  <h1>Services</h1>
  <button class="btn btn-primary" onclick="showAddServiceForm()">Add Service</button>
</div>

<div class="table-container">
  <table class="data-table" id="servicesTable">
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Price</th>
        <th>Status</th>
        <th>Description</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="servicesBody">
      <tr><td colspan="6">Loading...</td></tr>
    </tbody>
  </table>
</div>

<!-- Add Service Modal -->
<div id="addServiceModal" class="modal" style="display: none;">
  <div class="modal-content">
    <span class="close" onclick="hideAddServiceForm()">&times;</span>
    <h2>Add New Service</h2>
    <form id="addServiceForm">
      <label>Name: <input type="text" id="serviceName" required></label>
      <label>Type: 
        <select id="serviceType" required>
          <option value="">Select Type</option>
          <option value="cleaning">Cleaning</option>
          <option value="transport">Transport</option>
          <option value="spa">Spa</option>
          <option value="room-service">Room Service</option>
          <option value="other">Other</option>
        </select>
      </label>
      <label>Price: <input type="number" step="0.01" id="servicePrice" required></label>
      <label>Status: 
        <select id="serviceStatus" required>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
      </label>
      <label>Description: <textarea id="serviceDescription"></textarea></label>
      <button type="submit">Add Service</button>
      <button type="button" onclick="hideAddServiceForm()">Cancel</button>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  loadServices();
  
  // Add form submission handler
  document.getElementById('addServiceForm').addEventListener('submit', function(e) {
    e.preventDefault();
    createService();
  });
});

function loadServices() {
  fetch('/api/services')
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById('servicesBody');
      tbody.innerHTML = '';
      if (data.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">No services found</td></tr>';
      } else {
        data.forEach(service => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td>${service.name}</td>
            <td>${service.type}</td>
            <td>$${service.price}</td>
            <td><span class="status ${service.status}">${service.status}</span></td>
            <td>${service.description || ''}</td>
            <td>
              <button onclick="editService(${service.id})">Edit</button>
              <button onclick="deleteService(${service.id})">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      }
    })
    .catch(error => {
      console.error('Error loading services:', error);
      document.getElementById('servicesBody').innerHTML = '<tr><td colspan="6">Error loading services</td></tr>';
    });
}

function createService() {
  const data = {
    name: document.getElementById('serviceName').value,
    type: document.getElementById('serviceType').value,
    price: parseFloat(document.getElementById('servicePrice').value),
    status: document.getElementById('serviceStatus').value,
    description: document.getElementById('serviceDescription').value
  };
  
  fetch('/api/services', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(data)
  })
  .then(response => response.json())
  .then(result => {
    if (result.success) {
      hideAddServiceForm();
      loadServices();
      alert('Service created successfully!');
    } else {
      alert('Error: ' + (result.error || 'Unknown error'));
    }
  })
  .catch(error => {
    console.error('Error creating service:', error);
    alert('Error creating service');
  });
}

function showAddServiceForm() {
  document.getElementById('addServiceModal').style.display = 'block';
}

function hideAddServiceForm() {
  document.getElementById('addServiceModal').style.display = 'none';
  document.getElementById('addServiceForm').reset();
}

function editService(id) {
  alert('Edit service functionality to be implemented');
}

function deleteService(id) {
  if (confirm('Are you sure you want to delete this service?')) {
    alert('Delete service functionality to be implemented');
  }
}

// Close modal when clicking outside
window.onclick = function(event) {
  const modal = document.getElementById('addServiceModal');
  if (event.target == modal) {
    hideAddServiceForm();
  }
}
</script>
{% endblock %}